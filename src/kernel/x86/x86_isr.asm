bits 32

extern ISR_handler

%macro ISR_ERRORCODE 1

global _x86_ISR%1:
_x86_ISR%1:
    push %1
    jmp isr_common

%endmacro

%macro ISR_NO_ERRORCODE 1

global _x86_ISR%1:
_x86_ISR%1:
    push 0
    push %1
    jmp isr_common

%endmacro

ISR_NO_ERRORCODE 0
ISR_NO_ERRORCODE 1
ISR_NO_ERRORCODE 2
ISR_NO_ERRORCODE 3
ISR_NO_ERRORCODE 4
ISR_NO_ERRORCODE 5
ISR_NO_ERRORCODE 6
ISR_NO_ERRORCODE 7
ISR_ERRORCODE 8
ISR_NO_ERRORCODE 9
ISR_ERRORCODE 10
ISR_ERRORCODE 11
ISR_ERRORCODE 12
ISR_ERRORCODE 13
ISR_ERRORCODE 14
ISR_NO_ERRORCODE 15
ISR_NO_ERRORCODE 16
ISR_ERRORCODE 17
ISR_NO_ERRORCODE 18
ISR_NO_ERRORCODE 19
ISR_NO_ERRORCODE 20
ISR_ERRORCODE 21
ISR_NO_ERRORCODE 22
ISR_NO_ERRORCODE 23
ISR_NO_ERRORCODE 24
ISR_NO_ERRORCODE 25
ISR_NO_ERRORCODE 26
ISR_NO_ERRORCODE 27
ISR_NO_ERRORCODE 28
ISR_NO_ERRORCODE 29
ISR_NO_ERRORCODE 30
ISR_NO_ERRORCODE 31
ISR_NO_ERRORCODE 32
ISR_NO_ERRORCODE 33
ISR_NO_ERRORCODE 34
ISR_NO_ERRORCODE 35
ISR_NO_ERRORCODE 36
ISR_NO_ERRORCODE 37
ISR_NO_ERRORCODE 38
ISR_NO_ERRORCODE 39
ISR_NO_ERRORCODE 40
ISR_NO_ERRORCODE 41
ISR_NO_ERRORCODE 42
ISR_NO_ERRORCODE 43
ISR_NO_ERRORCODE 44
ISR_NO_ERRORCODE 45
ISR_NO_ERRORCODE 46
ISR_NO_ERRORCODE 47
ISR_NO_ERRORCODE 48
ISR_NO_ERRORCODE 49
ISR_NO_ERRORCODE 50
ISR_NO_ERRORCODE 51
ISR_NO_ERRORCODE 52
ISR_NO_ERRORCODE 53
ISR_NO_ERRORCODE 54
ISR_NO_ERRORCODE 55
ISR_NO_ERRORCODE 56
ISR_NO_ERRORCODE 57
ISR_NO_ERRORCODE 58
ISR_NO_ERRORCODE 59
ISR_NO_ERRORCODE 60
ISR_NO_ERRORCODE 61
ISR_NO_ERRORCODE 62
ISR_NO_ERRORCODE 63
ISR_NO_ERRORCODE 64
ISR_NO_ERRORCODE 65
ISR_NO_ERRORCODE 66
ISR_NO_ERRORCODE 67
ISR_NO_ERRORCODE 68
ISR_NO_ERRORCODE 69
ISR_NO_ERRORCODE 70
ISR_NO_ERRORCODE 71
ISR_NO_ERRORCODE 72
ISR_NO_ERRORCODE 73
ISR_NO_ERRORCODE 74
ISR_NO_ERRORCODE 75
ISR_NO_ERRORCODE 76
ISR_NO_ERRORCODE 77
ISR_NO_ERRORCODE 78
ISR_NO_ERRORCODE 79
ISR_NO_ERRORCODE 80
ISR_NO_ERRORCODE 81
ISR_NO_ERRORCODE 82
ISR_NO_ERRORCODE 83
ISR_NO_ERRORCODE 84
ISR_NO_ERRORCODE 85
ISR_NO_ERRORCODE 86
ISR_NO_ERRORCODE 87
ISR_NO_ERRORCODE 88
ISR_NO_ERRORCODE 89
ISR_NO_ERRORCODE 90
ISR_NO_ERRORCODE 91
ISR_NO_ERRORCODE 92
ISR_NO_ERRORCODE 93
ISR_NO_ERRORCODE 94
ISR_NO_ERRORCODE 95
ISR_NO_ERRORCODE 96
ISR_NO_ERRORCODE 97
ISR_NO_ERRORCODE 98
ISR_NO_ERRORCODE 99
ISR_NO_ERRORCODE 100
ISR_NO_ERRORCODE 101
ISR_NO_ERRORCODE 102
ISR_NO_ERRORCODE 103
ISR_NO_ERRORCODE 104
ISR_NO_ERRORCODE 105
ISR_NO_ERRORCODE 106
ISR_NO_ERRORCODE 107
ISR_NO_ERRORCODE 108
ISR_NO_ERRORCODE 109
ISR_NO_ERRORCODE 110
ISR_NO_ERRORCODE 111
ISR_NO_ERRORCODE 112
ISR_NO_ERRORCODE 113
ISR_NO_ERRORCODE 114
ISR_NO_ERRORCODE 115
ISR_NO_ERRORCODE 116
ISR_NO_ERRORCODE 117
ISR_NO_ERRORCODE 118
ISR_NO_ERRORCODE 119
ISR_NO_ERRORCODE 120
ISR_NO_ERRORCODE 121
ISR_NO_ERRORCODE 122
ISR_NO_ERRORCODE 123
ISR_NO_ERRORCODE 124
ISR_NO_ERRORCODE 125
ISR_NO_ERRORCODE 126
ISR_NO_ERRORCODE 127
ISR_NO_ERRORCODE 128
ISR_NO_ERRORCODE 129
ISR_NO_ERRORCODE 130
ISR_NO_ERRORCODE 131
ISR_NO_ERRORCODE 132
ISR_NO_ERRORCODE 133
ISR_NO_ERRORCODE 134
ISR_NO_ERRORCODE 135
ISR_NO_ERRORCODE 136
ISR_NO_ERRORCODE 137
ISR_NO_ERRORCODE 138
ISR_NO_ERRORCODE 139
ISR_NO_ERRORCODE 140
ISR_NO_ERRORCODE 141
ISR_NO_ERRORCODE 142
ISR_NO_ERRORCODE 143
ISR_NO_ERRORCODE 144
ISR_NO_ERRORCODE 145
ISR_NO_ERRORCODE 146
ISR_NO_ERRORCODE 147
ISR_NO_ERRORCODE 148
ISR_NO_ERRORCODE 149
ISR_NO_ERRORCODE 150
ISR_NO_ERRORCODE 151
ISR_NO_ERRORCODE 152
ISR_NO_ERRORCODE 153
ISR_NO_ERRORCODE 154
ISR_NO_ERRORCODE 155
ISR_NO_ERRORCODE 156
ISR_NO_ERRORCODE 157
ISR_NO_ERRORCODE 158
ISR_NO_ERRORCODE 159
ISR_NO_ERRORCODE 160
ISR_NO_ERRORCODE 161
ISR_NO_ERRORCODE 162
ISR_NO_ERRORCODE 163
ISR_NO_ERRORCODE 164
ISR_NO_ERRORCODE 165
ISR_NO_ERRORCODE 166
ISR_NO_ERRORCODE 167
ISR_NO_ERRORCODE 168
ISR_NO_ERRORCODE 169
ISR_NO_ERRORCODE 170
ISR_NO_ERRORCODE 171
ISR_NO_ERRORCODE 172
ISR_NO_ERRORCODE 173
ISR_NO_ERRORCODE 174
ISR_NO_ERRORCODE 175
ISR_NO_ERRORCODE 176
ISR_NO_ERRORCODE 177
ISR_NO_ERRORCODE 178
ISR_NO_ERRORCODE 179
ISR_NO_ERRORCODE 180
ISR_NO_ERRORCODE 181
ISR_NO_ERRORCODE 182
ISR_NO_ERRORCODE 183
ISR_NO_ERRORCODE 184
ISR_NO_ERRORCODE 185
ISR_NO_ERRORCODE 186
ISR_NO_ERRORCODE 187
ISR_NO_ERRORCODE 188
ISR_NO_ERRORCODE 189
ISR_NO_ERRORCODE 190
ISR_NO_ERRORCODE 191
ISR_NO_ERRORCODE 192
ISR_NO_ERRORCODE 193
ISR_NO_ERRORCODE 194
ISR_NO_ERRORCODE 195
ISR_NO_ERRORCODE 196
ISR_NO_ERRORCODE 197
ISR_NO_ERRORCODE 198
ISR_NO_ERRORCODE 199
ISR_NO_ERRORCODE 200
ISR_NO_ERRORCODE 201
ISR_NO_ERRORCODE 202
ISR_NO_ERRORCODE 203
ISR_NO_ERRORCODE 204
ISR_NO_ERRORCODE 205
ISR_NO_ERRORCODE 206
ISR_NO_ERRORCODE 207
ISR_NO_ERRORCODE 208
ISR_NO_ERRORCODE 209
ISR_NO_ERRORCODE 210
ISR_NO_ERRORCODE 211
ISR_NO_ERRORCODE 212
ISR_NO_ERRORCODE 213
ISR_NO_ERRORCODE 214
ISR_NO_ERRORCODE 215
ISR_NO_ERRORCODE 216
ISR_NO_ERRORCODE 217
ISR_NO_ERRORCODE 218
ISR_NO_ERRORCODE 219
ISR_NO_ERRORCODE 220
ISR_NO_ERRORCODE 221
ISR_NO_ERRORCODE 222
ISR_NO_ERRORCODE 223
ISR_NO_ERRORCODE 224
ISR_NO_ERRORCODE 225
ISR_NO_ERRORCODE 226
ISR_NO_ERRORCODE 227
ISR_NO_ERRORCODE 228
ISR_NO_ERRORCODE 229
ISR_NO_ERRORCODE 230
ISR_NO_ERRORCODE 231
ISR_NO_ERRORCODE 232
ISR_NO_ERRORCODE 233
ISR_NO_ERRORCODE 234
ISR_NO_ERRORCODE 235
ISR_NO_ERRORCODE 236
ISR_NO_ERRORCODE 237
ISR_NO_ERRORCODE 238
ISR_NO_ERRORCODE 239
ISR_NO_ERRORCODE 240
ISR_NO_ERRORCODE 241
ISR_NO_ERRORCODE 242
ISR_NO_ERRORCODE 243
ISR_NO_ERRORCODE 244
ISR_NO_ERRORCODE 245
ISR_NO_ERRORCODE 246
ISR_NO_ERRORCODE 247
ISR_NO_ERRORCODE 248
ISR_NO_ERRORCODE 249
ISR_NO_ERRORCODE 250
ISR_NO_ERRORCODE 251
ISR_NO_ERRORCODE 252
ISR_NO_ERRORCODE 253
ISR_NO_ERRORCODE 254
ISR_NO_ERRORCODE 255

isr_common:
    pusha ; Save in order: eax, ecx, edx, ebx, esp, ebp, esi, edi
    
    ; Save ds segment
    xor eax,eax
    mov ax, ds
    push eax


    mov ax, 0x10
    mov ds, ax
    mov es, ax
    mov fs, ax
    mov gs, ax

    push esp
    call ISR_handler
    add esp,4

    pop eax
    mov ds, ax
    mov es, ax
    mov fs, ax
    mov gs, ax

    popa
    add esp, 8
    iret